
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Wei Liang">
      
      
        <link rel="canonical" href="https://w62liang.github.io/intro-to-causal/chapters/utwo-sample.html">
      
      
        <link rel="prev" href="prelim-testing.html">
      
      
        <link rel="next" href="reg-analysis.html">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Chapter 4. Univariate Two-Sample Test - Intro to Causal Inference</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    

      
    

<script src="../javascripts/mathjax.js"></script>


    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/custom-appr.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#univariate-two-sample-test" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Intro to Causal Inference" class="md-header__button md-logo" aria-label="Intro to Causal Inference" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Intro to Causal Inference
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 4. Univariate Two-Sample Test
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Intro to Causal Inference" class="md-nav__button md-logo" aria-label="Intro to Causal Inference" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Intro to Causal Inference
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="causal-intro.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 1. Causality
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="randomization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 2. Randomization Methods
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="prelim-testing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 3. Prelimilaries on Hypothesis Testing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Chapter 4. Univariate Two-Sample Test
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="utwo-sample.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Chapter 4. Univariate Two-Sample Test
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#statistical-models-and-notation" class="md-nav__link">
    <span class="md-ellipsis">
      Statistical Models and Notation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#two-sided-z-test" class="md-nav__link">
    <span class="md-ellipsis">
      Two-Sided Z-Test
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Two-Sided Z-Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#t-statistic" class="md-nav__link">
    <span class="md-ellipsis">
      T-Statistic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-testing-procedure" class="md-nav__link">
    <span class="md-ellipsis">
      The Testing Procedure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#power-and-sample-size-determination" class="md-nav__link">
    <span class="md-ellipsis">
      Power and Sample Size Determination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#two-sided-p-value" class="md-nav__link">
    <span class="md-ellipsis">
      Two-Sided P-Value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one-sided-z-test" class="md-nav__link">
    <span class="md-ellipsis">
      One-Sided Z-Test
    </span>
  </a>
  
    <nav class="md-nav" aria-label="One-Sided Z-Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#t-statistic_1" class="md-nav__link">
    <span class="md-ellipsis">
      T-Statistic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-testing-procedure_1" class="md-nav__link">
    <span class="md-ellipsis">
      The Testing Procedure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#power-and-sample-size-determination_1" class="md-nav__link">
    <span class="md-ellipsis">
      Power and Sample Size Determination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one-sided-p-value" class="md-nav__link">
    <span class="md-ellipsis">
      One-Sided P-Value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#z-test-under-covariate-adaptive-randomization" class="md-nav__link">
    <span class="md-ellipsis">
      Z-Test under Covariate-Adaptive Randomization
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="reg-analysis.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 5. Regression Analysis of Experimental Data
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="instrument-var.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 6. Handling Noncompliance through Instrumental Variable Approach
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="survival.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 7. Survival Analysis
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="clinical-trial.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 8. Applications to Clinical Trials
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="ab-testing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 9. Applications to A/B Testing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="observational-study.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 10. Observational Studies
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="sens-analysis.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 11. VanderWeele-Ding Sensitivity Analysis
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#statistical-models-and-notation" class="md-nav__link">
    <span class="md-ellipsis">
      Statistical Models and Notation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#two-sided-z-test" class="md-nav__link">
    <span class="md-ellipsis">
      Two-Sided Z-Test
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Two-Sided Z-Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#t-statistic" class="md-nav__link">
    <span class="md-ellipsis">
      T-Statistic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-testing-procedure" class="md-nav__link">
    <span class="md-ellipsis">
      The Testing Procedure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#power-and-sample-size-determination" class="md-nav__link">
    <span class="md-ellipsis">
      Power and Sample Size Determination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#two-sided-p-value" class="md-nav__link">
    <span class="md-ellipsis">
      Two-Sided P-Value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one-sided-z-test" class="md-nav__link">
    <span class="md-ellipsis">
      One-Sided Z-Test
    </span>
  </a>
  
    <nav class="md-nav" aria-label="One-Sided Z-Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#t-statistic_1" class="md-nav__link">
    <span class="md-ellipsis">
      T-Statistic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-testing-procedure_1" class="md-nav__link">
    <span class="md-ellipsis">
      The Testing Procedure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#power-and-sample-size-determination_1" class="md-nav__link">
    <span class="md-ellipsis">
      Power and Sample Size Determination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one-sided-p-value" class="md-nav__link">
    <span class="md-ellipsis">
      One-Sided P-Value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#z-test-under-covariate-adaptive-randomization" class="md-nav__link">
    <span class="md-ellipsis">
      Z-Test under Covariate-Adaptive Randomization
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="univariate-two-sample-test">Univariate Two-Sample Test</h1>
<p>Practitioners collect data during or at the end of an experiment and the data are used for statistical analysis. When the outcome measurement is a scalar variable at a certain time point, a problem of primary interest is whether the average treatment effect (ATE) on the outcome is significant. In this chapter, we introduce two-sample tests for this problem and discuss related issues such as sample size determination.</p>
<h2 id="statistical-models-and-notation">Statistical Models and Notation</h2>
<p>Suppse we collect data $\mathcal{G}=\{(Y_i,A_i,X_i),i=1,\cdots,n\}$ through an experiment where $A_i\in\{0,1\}$ are treatment indicators, $Y_i=Y_i(A_i)$ are observed outcomes (survival; cell concentration), and $X_i$ are baseline covariates (age, gender, blood pressure, etc.). We assume</p>
<ul>
<li><strong>A1</strong>. $(Y_i(1),Y_i(0))$ are i.i.d. copies of $(Y(1),Y(0))$.</li>
<li><strong>A2</strong>. $\{(Y_i(1),Y_i(0)),i=1,\cdots,n\}\perp \!\!\!\perp \{A_1,\cdots,A_n\}$.</li>
<li><strong>A3</strong>. $E(A_i)=\pi\in(0,1)$ for $i=1,\cdots,n$.</li>
</ul>
<p>These assumptions are mild and standard for experimental data under covariate-free randomization of treatment assignments. Denote $n_a=\#\{i:A_i=a\}$, $\mu_a=E[Y(a)]$ and $\sigma^2_a=\operatorname{var}\{Y(a)\}$ for $a=0,1$. Let $\bar{Y}_a=n_a^{-1}\sum_{i:A_i=a}Y_i$ be the sample mean in group $A_i=a$ and 
$$
S_a^2 = \frac{1}{n_a-1}\sum_{i:A_i=a}(Y_i-\bar{Y}_a)^2
$$
the correponding sample variance. The two statistics are respectively unbiased estimators of $\mu_a$ and $\sigma_a^2$. The average treatment effect (ATE), also known as the risk difference (RD) in epidemiology, is defined by $\tau=\mu_1-\mu_0$. </p>
<h2 id="two-sided-z-test">Two-Sided Z-Test</h2>
<p>We are primarily interest in testing the null hypothesis $H_0: \tau=0$ versus the alternative hypothesis $H_1: \tau\neq 0$.</p>
<h3 id="t-statistic">T-Statistic</h3>
<p>To test the null, we consider the t-statistic $T = T(\mathcal{G})=\hat{\tau}/S_{\tau}$ where $\hat{\tau}=\bar{Y}_1 - \bar{Y}_0$ and $S_{\tau}=\sqrt{S_1^2/n_1 + S_0^2/n_0}$. This test statistic is motivated from that $\hat{\tau}$ is a natural sample estimator of $\tau$ and $S^2_{\tau}$ is the sample estimator for
$$
\sigma_{\tau}^2=\operatorname{Var}(\hat{\tau})=\frac{1}{n}\left\{\frac{\sigma_1^2}{\pi} + \frac{\sigma_0^2}{1-\pi}\right\}.
$$
By the Central Limit Theorem (CLT) and the Slutsky's Theorem , one can verify that $T$ is asymptotically standard normal under $H_0$.</p>
<h3 id="the-testing-procedure">The Testing Procedure</h3>
<p>Intuitively, $T$ should be close to $0$ when $H_0$ is correct. Let $\mathcal{O}=\{(y_i,a_i,x_i),i=1,\cdots,n\}$ denote realized values of the data. The critical region therefore has the form $R(c)=\{\mathcal{O}:|T(\mathcal{O})|&gt;c \}$ for some constant $c&gt;0$.</p>
<p>To control Type I Error at $\alpha$, we hope $P(\mathcal{G}\in R(c)\mid H_0)=P(T&gt;c\mid H_0)+P(T&lt;-c\mid H_0)\leq \alpha$. Since $T\mid H_0\overset{d}{\rightarrow}N(0,1)$, we can set $c=z_{\alpha/2}$ as the upper $\alpha/2$-quantile of $N(0,1)$ (i.e., $P(N(0,1)\geq z_{\alpha/2})=\alpha/2$). It follows that
$$
P(\mathcal{G}\in R(c)\mid H_0)=P(T&gt;z_{\alpha/2}\mid H_0)+P(T&lt;-z_{\alpha/2}\mid H_0)\rightarrow \alpha.
$$</p>
<h3 id="power-and-sample-size-determination">Power and Sample Size Determination</h3>
<p>The power of the testing procedure is given by
$$
\begin{aligned}
\beta(\tau,\sigma_{\tau})=&amp;P_{\tau}(|T|&gt;z_{\alpha/2})\\
=&amp; P_{\tau}\left(\frac{\hat{\tau}}{S_{\tau}}&gt;z_{\alpha/2}\right) + P_{\pi}\left(\frac{\hat{\tau}}{S_{\tau}}&lt;-z_{\alpha/2}\right)\\
=&amp; P_{\tau}\left(\frac{(\hat{\tau}-\tau)}{S_{\tau}}&gt;z_{\alpha/2}-\frac{\tau}{S_{\tau}}\right) + P_{\tau}\left(\frac{(\hat{\tau}-\tau)}{S_{\tau}}&lt;-z_{\alpha/2}-\frac{\tau}{S_{\tau}}\right)\\
= &amp; 1-\Phi\left(z_{\alpha/2}-\frac{\tau}{\sigma_{\tau}}\right) + \Phi\left(-z_{\alpha/2}-\frac{\tau}{\sigma_{\tau}}\right) + o(1).
\end{aligned}
$$
Taking partial derivative of the power function with respect to $\sigma_{\tau}$ gives 
$$
\begin{aligned}
\frac{\partial \beta(\tau,\sigma_{\tau})}{\partial \sigma_{\tau}}&amp;=\frac{\tau}{\sigma_{\tau}^2} \left\{\phi(z_{\alpha/2}+\sigma_{\tau}^{-1}\tau) - \phi(z_{\alpha/2}-\sigma_{\tau}^{-1}\tau)\right\}+o(1)\\
&amp;\approx \frac{|\tau|}{\sigma_{\tau}^2} \left\{\phi(z_{\alpha/2}+\sigma_{\tau}^{-1}|\tau|) - \phi(z_{\alpha/2}-\sigma_{\tau}^{-1}|\tau|)\right\}\leq 0,
\end{aligned}
$$
and the equality holds if and only if $\tau=0$. This implies that, asymptotically, the Type II Error of the proposed testing procedure drops down as $n$ increases because $\sigma_{\tau}$ decreases. When fixing $\tau&gt;0$, $\beta(\tau,\sigma_{\tau})=\gamma$ has a unique solution which is the standard deviation needed for detecting the ATE of at least $\tau$ with the power $\gamma$. However, the solution has no closed-form and can only be solved from the equation $\beta(\tau,\sigma_{\tau})=\gamma$ using, for example, the Newton's method.</p>
<p>Let us consider the settings where the outcomes are binary. Then, we can verify that $S_a^2=[n_a/(n_a-1)]\bar{Y}_a(1-\bar{Y}_a)$ and
$$
S_{\tau}=\left\{\frac{\bar{Y}_1(1-\bar{Y}_1)}{n_1-1}+\frac{\bar{Y}_0(1-\bar{Y}_0)}{n_0-1}\right\}^{1/2}.
$$
The Titu's lemma states that $a^2/x+b^2/y\geq (a+b)^2/(x+y)$ when $x,y&gt;0$, followed from which we have
$$
S_{\tau}^2\geq (n-2)^{-1}\left(\sqrt{\bar{Y}_1(1-\bar{Y}_1)}+\sqrt{\bar{Y}_0(1-\bar{Y}_0)}\right)^2
$$
and thus
$$
n\geq S_{\tau}^{-2}\left\{\sqrt{\bar{Y}_0(1-\bar{Y}_0)}+\sqrt{(\bar{Y}_0+\tau)(1-\bar{Y}_0-\tau)}\right\}^2+2.
$$
Therefore, to detect an ATE of $\tau$ with power at least $\gamma$, roughly we need a sample size of
$$
n \geq \hat{\sigma}_{\tau}^{-2}(\tau,\gamma)\left\{\sqrt{\mu_0(1-\mu_0)}+\sqrt{(\mu_0+\tau)(1-\mu_0-\tau)}\right\}^2+2
$$
where $\hat{\sigma}_{\tau}(\tau,\gamma)$ is the solution to $\beta(\tau,\sigma_{\tau})=\gamma$.</p>
<p>When $n_1=n_0$, we have 
$$
n_1=n_0=S_{\tau}^{-2}\left\{\bar{Y}_1(1-\bar{Y}_1)+\bar{Y}_0(1-\bar{Y}_0)\right\} + 1.
$$
In this case, the minimum sample size for each group to detect an ATE of $\tau$ with power at least $\gamma$ is
$$
n_1=n_0= \hat{\sigma}_{\tau}^{-2}(\tau,\gamma)\left\{\mu_0(1-\mu_0)+(\mu_0+\tau)(1-\mu_0-\tau)\right\} + 1.
$$</p>
<h3 id="two-sided-p-value">Two-Sided P-Value</h3>
<p>With the observed data $\mathcal{O}$, a two-sided p-value can be computed by $P(|T|&gt;|T(\mathcal{O})|\mid H_0)=2-2\Phi(|T(\mathcal{O})|)$.</p>
<h2 id="one-sided-z-test">One-Sided Z-Test</h2>
<p>Consider testing the null hypothesis $H_0: \tau&gt;0$ versus the alternative hypothesis $H_1: \tau\leq 0$. The null space of the parameter is $\Theta_0=(0,+\infty)$ and the alternative space is $\Theta_1=(-\infty,0]$.</p>
<h3 id="t-statistic_1">T-Statistic</h3>
<p>Similarly, we consider the t-statistic $T = T(\mathcal{G})=\hat{\tau}/S_{\tau}$. Then, for $\tau\in\Theta_0$, we have $T-S_{\tau}^{-1}\tau\overset{d}{\rightarrow}N(0,1)$.</p>
<h3 id="the-testing-procedure_1">The Testing Procedure</h3>
<p>Intuitively, $T$ should be significantly greater than $0$ when $H_0$ is correct. The critical region therefore has the form $R(c)=\{\mathcal{O}: T(\mathcal{O})\leq c \}$ for some constant $c$.</p>
<p>To control Type I Error at $\alpha$, we can set $c=-z_{\alpha}$. It follows that
$$
\begin{aligned}
P(\mathcal{G}\in R(c)\mid H_0)&amp; \leq \sup_{\tau&gt;0}P_{\tau}(T \leq -z_{\alpha})\\
&amp; \leq\sup_{\tau&gt;0}P_{\tau}(T-S_{\tau}^{-1}\tau +(S_{\tau}^{-1}-\sigma_{\tau}^{-1})\tau \leq -z_{\alpha}-\sigma_{\tau}^{-1}\tau)\\
&amp; \leq\sup_{\tau&gt;0}\Phi(-z_{\alpha}-\sigma_{\tau}^{-1}\tau)+o(1) \leq \alpha+o(1).
\end{aligned}
$$</p>
<h3 id="power-and-sample-size-determination_1">Power and Sample Size Determination</h3>
<p>The power of the testing procedure is given by
$$
\begin{aligned}
\beta(\tau,\sigma_{\tau})=&amp;P_{\tau}(T \leq -z_{\alpha})\\
=&amp; P_{\tau}(T-S_{\tau}^{-1}\tau +(S_{\tau}^{-1}-\sigma_{\tau}^{-1})\tau \leq -z_{\alpha}-\sigma_{\tau}^{-1}\tau)\\
\approx &amp; \Phi(-z_{\alpha}-\sigma_{\tau}^{-1}\tau)
\end{aligned}
$$
which is trivially a monotonically decreasing function of $\sigma_{\tau}$ when $H_1$ is true. For one-sided z-test, the solution to the equation $\beta(\tau,\sigma_{\tau})=\gamma$ has a closed form:
$$
\sigma_{\tau}(\tau,\gamma) = -\tau/(z_{\alpha}+z_{1-\gamma}) 
$$</p>
<p>Similarly, we consider the settings of binary outcomes. To detect an ATE of $\tau$ with power at least $\gamma$ when $H_1$ is true, roughly we need a sample size of
$$
n \geq (z_{\alpha}+z_{1-\gamma})^2\left\{\sqrt{\mu_0(1-\mu_0)}+\sqrt{(\mu_0+\tau)(1-\mu_0-\tau)}\right\}^2/\tau^2+2.
$$
When $n_1=n_0$, the minimum number of samples we need is
$$
n_1 = (z_{\alpha}+z_{1-\gamma})^2\left\{\mu_0(1-\mu_0)+(\mu_0+\tau)(1-\mu_0-\tau)\right\}/\tau^2 + 1
$$</p>
<h3 id="one-sided-p-value">One-Sided P-Value</h3>
<p>In one-sided z-test, we can set $W=-T$ which yields the p-value
$$
\sup_{\pi &gt; 0}P_{\pi}(-T\geq -T(\mathcal{O}))=\sup_{\pi &gt; 0}\Phi(T(\mathcal{O})-\tau/\sigma_{\tau})=\Phi(T(\mathcal{O})).
$$</p>
<h2 id="z-test-under-covariate-adaptive-randomization">Z-Test under Covariate-Adaptive Randomization</h2>
<p>Under covariate-adaptive randomization, suppose the sample units are divided into $K$ strata indexed by $\{1,\cdots,K\}$. We use $Z_i$ to denote a $K$-dimensional indicator variable of strata and assume $Z_i=e_k$ if the unit $i$ is assigned to stratum $k$, where $e_k$ is a $K$-dimentional one-hot vector whose $k$-th component is $1$ and others are $0$. Still, we impose assumptions <strong>A1</strong>--<strong>A3</strong>, except that we modifiy <strong>A2</strong> to that </p>
<ul>
<li><strong>A2</strong> $\{(Y_i(1),Y_i(0)),i=1,\cdots,n\}\perp \!\!\!\perp \{A_1,\cdots,A_n\} \mid \{Z_1,\cdots,Z_n\}$,</li>
</ul>
<p>i.e., independence holds for every stratum. Now, we introduce a testing procedure generated by confidence intervals. In other words, we consider interval estimation of $\tau$. </p>
<p>Let $N_k=\sum_{i=1}^n1\{Z_i=e_k\}$ be the sample size of the stratum $k$, $N_{k1}=\sum_{i=1}^n\{Z_i=e_k\}A_i$, and $N_{k0}=N_k-N_{k1}$. Let $\bar{Y}_{ka}=N_{ak}^{-1}\sum_{Z_i=e_k,A_i=a}Y_i$ and $\hat{\tau}_k=\bar{Y}_{1k} - \bar{Y}_{0k}$ be the difference in means estimator of the ATE in the stratum $k$. Then, we can estimate $\tau$ by $\hat{\tau}=\sum_{k=1}^K(N_k/n)\hat{\tau}_k$, which is unbiased and consistent. The variance of $\hat{\tau}$ is given by
$$
\begin{aligned}
\sigma_{\tau,s}^2=\operatorname{var}(\hat{\tau}) =&amp; E\left\{\sum_{k=1}^K(N_k^2/n^2)\operatorname{var}(\hat{\tau}_k\mid Z_1,\cdots,Z_n)\right\}\\
=&amp; E\left\{\sum_{k=1}^K\frac{N_k^2}{n^2}\left(\frac{\sigma_{1k}^2}{N_{1k}}+\frac{\sigma_{0k}^2}{N_{0k}}\right)\right\}\\
=&amp; \frac{1}{n}\left\{\frac{E[\operatorname{var}(Y_i(1)\mid Z_i)]}{\pi} + \frac{E[\operatorname{var}(Y_i(0)\mid Z_i)]}{1-\pi}\right\},
\end{aligned}
$$
where $\sigma_{ak}^2=\operatorname{var}(Y_i(a)\mid Z_i=e_k)$. Note that
$$
\sigma_{\tau}^2 - \sigma_{\tau,s}^2 =\frac{\operatorname{var}[E(Y_i(1)\mid Z_i)]}{n\pi}+\frac{\operatorname{var}[E(Y_i(0)\mid Z_i)]}{n(1-\pi)}\geq 0.
$$
Therefore, owing to stratification, the variance of the estimator for the ATE is reduced and the reduction relies on the between-stratum variance of the outcome variable. We can estimate $\sigma_{\tau,s}^2$ by
$$
S_{\tau,s}^2 = \sum_{k=1}^K\frac{N_k^2}{n^2}\left(\frac{S_{1k}^2}{N_{1k}}+\frac{S_{0k}^2}{N_{0k}}\right)
$$
where $S_{ak}^2=(N_{ak}-1)^{-1}\sum_{A_i=a,Z_i=e_k}(Y_i-\bar{Y}_{ak})^2$. Under certain regularity conditions, it can be shown that $(\hat{\tau}-\tau)/S_{\tau}$ converges to the standard normal distribution. A two-sided $(1-\alpha)$ confidence interval for $\tau$ is then given as $C_{\alpha}=[\hat{\tau}-S_{\tau,s}z_{\alpha/2},\hat{\tau}+S_{\tau,s}z_{\alpha/2}]$ and we can verify that
$$
P(\tau\in C_{\alpha})=P(|(\hat{\tau}-\tau)/S_{\tau,s}|\leq z_{\alpha/2})=1-\alpha+o(1).
$$
To test the one-sided hypothese $H_0:\tau&gt;0$ versus $H_1:\tau\leq 0$, the $(1-\alpha)$ confidence interval can be given by $C_{\alpha}=(-\infty,\hat{\tau}+S_{\tau,s}z_{\alpha}]$ and a testing procedure can be set as: We reject the null if $0\notin C_{\alpha}(\mathcal{O})$ and accept the null otherwise. The power of the resuling testing procedure under $H_1$ is given by
$$
\begin{aligned}
\beta(\tau,\sigma_{\tau,s}) =&amp; P_{\tau}(\hat{\tau}+S_{\tau,s}z_{\alpha}&lt; 0)\\
 =&amp; P_{\tau}((\hat{\tau} - \tau)/S_{\tau,s} &lt; -z_{\alpha} - \tau/S_{\tau,s})\\
 =&amp; \Phi(-z_{\alpha}-\sigma_{\tau,s}^{-1}\tau) + o(1),
\end{aligned}
$$
which is a monotonically decreasing function of $\sigma_{\tau,s}$. Because $\sigma_{\tau,s}\leq \sigma_{\tau}$, we have $\beta(\tau,\sigma_{\tau,s})\geq \beta(\tau,\sigma_{\tau})$ under $H_1$.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      © 2025 Wei Liang — Licensed under <a href='https://creativecommons.org/licenses/by/4.0/'>CC BY 4.0</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.annotate", "content.tooltips", "navigation.top", "search.highlight", "search.share", "search.suggest"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>